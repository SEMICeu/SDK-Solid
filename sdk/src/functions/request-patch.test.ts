import { describe, expect, test } from 'vitest';
import { Patch } from '../models/patch-model';
import { requestPatch } from './request-patch';

describe('requestPatch', () => {

  test('should conform to PoC with a state', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
      'd8c4c1bdd9ba45e182a26d32d988f916'
    ))
      .resolves.toEqual('https://auth.dev-use.id/oauth/authorize?client_id=https%3A%2F%2Fsandbox.webid.solid4energy.eliagroup.io%2F&response_type=code&state=d8c4c1bdd9ba45e182a26d32d988f916&redirect_uri=https%3A%2F%2Felia-ep8lqo.flutterflow.app%2Fstart&code_challenge_method=S256&code_challenge=hjooUY_1tBlE_dBuCKGUK8XuSRrc_zNByH-roC5sIXA&email=tom%2B20nov231%40digita.ai&solid_patch=G6IXAJwHdgyxyhI4TqJ1raN5qV8c3OoTo5qlr0tniWxV2Zv%2F%2F1c7PiYDoG%2BdrQ2k7NNoO60rR4Fpiv0bFUbSIrvgP3lKvHkVd2Dp4HYl%2B%2BJ4mZnF0C5j2bddgb6t2qg2RKmMSkXgrK0c70qjSR7gQHzl2BqbggeTcugVzFxm4CgJVguSDPIR9gWREsiWNLVoNFLSke%2Frc06W2z5vquHRtDVoXTq8IAkqOvaLG3UBftlwz8y8x56pPZYyzDD1iTt5BwyNjgbKYhgEw4%2BFG8tAKKW5OLtJTQVXSQiYFJMUhUan0viP%2BgOZSACUXRVKr%2Be63N6oCxpTig2zEoWymp0PQzicBRvG6axCObWFkZgm5HzL0hG%2BBMCCkCcdAPVg3XJHOrHc%2FpQJk%2Fkc1nsHCCI3MFOxnGt2SPzFBYvbKA%2FAM4UngFOxWLsTGa7onSug9C8q1rqvu656cftl');

  });

  test('should conform to PoC with a state', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .resolves.toEqual('https://auth.dev-use.id/oauth/authorize?client_id=https%3A%2F%2Fsandbox.webid.solid4energy.eliagroup.io%2F&response_type=code&redirect_uri=https%3A%2F%2Felia-ep8lqo.flutterflow.app%2Fstart&code_challenge_method=S256&code_challenge=hjooUY_1tBlE_dBuCKGUK8XuSRrc_zNByH-roC5sIXA&email=tom%2B20nov231%40digita.ai&solid_patch=G6IXAJwHdgyxyhI4TqJ1raN5qV8c3OoTo5qlr0tniWxV2Zv%2F%2F1c7PiYDoG%2BdrQ2k7NNoO60rR4Fpiv0bFUbSIrvgP3lKvHkVd2Dp4HYl%2B%2BJ4mZnF0C5j2bddgb6t2qg2RKmMSkXgrK0c70qjSR7gQHzl2BqbggeTcugVzFxm4CgJVguSDPIR9gWREsiWNLVoNFLSke%2Frc06W2z5vquHRtDVoXTq8IAkqOvaLG3UBftlwz8y8x56pPZYyzDD1iTt5BwyNjgbKYhgEw4%2BFG8tAKKW5OLtJTQVXSQiYFJMUhUan0viP%2BgOZSACUXRVKr%2Be63N6oCxpTig2zEoWymp0PQzicBRvG6axCObWFkZgm5HzL0hG%2BBMCCkCcdAPVg3XJHOrHc%2FpQJk%2Fkc1nsHCCI3MFOxnGt2SPzFBYvbKA%2FAM4UngFOxWLsTGa7onSug9C8q1rqvu656cftl');

  });

  test('should throw when idpBaseUri is an invalid URI', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'bla', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .rejects.toThrow();

  });

  test('should throw when redirectUri is an invalid URI', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'bla', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .rejects.toThrow();

  });

  test('should throw when email is empty', async () => {

    await expect(requestPatch(
      '', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .rejects.toThrow();

  });

  test('should throw when code verifier is empty', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      '', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      'https://sandbox.webid.solid4energy.eliagroup.io/', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .rejects.toThrow();

  });

  test('should throw when client ID is empty', async () => {

    await expect(requestPatch(
      'tom+20nov231@digita.ai', // email
      'zo6yP8H9te4I0lk2Uclcry47yPbTT9jRbdnIZPdMUfazH5iD8vkNw', // code verifier
      'https://auth.dev-use.id', // idpBaseUri
      '', // clientId
      'https://elia-ep8lqo.flutterflow.app/start', // redirectUri
      JSON.parse('{"conditions":{"tos_uri":"https://example.com/tos","policy_uri":"https://example.com/policy","legal_basis_uri":["https://example.com/legal-basis"],"purpose_uri":["https://example.com/purpose"]},"add":{"access":{"subject_type_combo":[{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/consent","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://dev-use.id/tom-20nov231","allowed_azp_uri":"https://sandbox.webid.solid4energy.eliagroup.io/","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/picture","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.nest-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"write","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/measurement","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"create","storage":"*"},{"applies_to_subject_uri":"https://dev-use.id/tom-20nov231","applies_to_type_uri":"https://elia.com/contract","allowed_subject_uri":"https://sandbox.realto-solid.com/","allowed_azp_uri":"*","allowed_issuer_uri":"*","allowed_access_mode":"read","storage":"*"}],"resource":[]}},"remove":{"access":{"subject_type_combo":[],"resource":[]}}}') as Patch,
    ))
      .rejects.toThrow();

  });

});

